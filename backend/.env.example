# ==============================================
# GRUBTECH BACKEND - ENVIRONMENT CONFIGURATION
# ==============================================
# Copy this file to .env and fill in the values
# NEVER commit .env to version control!

# ==============================================
# SERVER CONFIGURATION
# ==============================================
NODE_ENV=development
PORT=3001

# ==============================================
# SECURITY CONFIGURATION (REQUIRED!)
# ==============================================

# JWT Secret Key - REQUIRED! Application will not start without it.
# Requirements:
#   - Development: Minimum 32 characters
#   - Production: MUST be 64+ characters, cannot contain "change"
#
# Generate a secure random secret (produces 64 characters):
#   openssl rand -hex 32
#   node -e "console.log(require('crypto').randomBytes(32).toString('hex'))"
#
# CRITICAL: Never commit your actual JWT_SECRET to version control!
JWT_SECRET=your-super-secret-jwt-key-change-this-in-production-minimum-32-chars
JWT_EXPIRES_IN=7d

# ==============================================
# SETUP ADMIN FEATURE - SECURITY CRITICAL!
# ==============================================
#
# ⚠️  WARNING: This feature is designed for INITIAL SETUP ONLY!
# ⚠️  Leaving this enabled in production creates a CRITICAL SECURITY VULNERABILITY!
#
# PURPOSE:
# --------
# The setup admin feature provides a one-time mechanism to create the first
# admin user when deploying to a new environment. Once an admin exists, this
# feature MUST be disabled immediately.
#
# SECURITY IMPLICATIONS:
# ----------------------
# When ENABLE_SETUP_ADMIN=true:
# ✗ Anyone with the SETUP_SECRET_TOKEN can create admin accounts
# ✗ Creates a backdoor that attackers can exploit if token is compromised
# ✗ Bypasses normal authentication and authorization controls
# ✗ Could allow privilege escalation attacks
# ✗ May expose internal system configuration
#
# When ENABLE_SETUP_ADMIN=false (REQUIRED for production):
# ✓ Setup endpoint is completely disabled and returns 404
# ✓ No backdoor exists for unauthorized admin creation
# ✓ All admin users must be created through secure, authenticated channels
# ✓ Follows principle of least privilege
#
# PROPER USAGE WORKFLOW:
# ----------------------
# 1. INITIAL DEPLOYMENT:
#    - Set ENABLE_SETUP_ADMIN=true (ONLY for initial setup)
#    - Generate a strong SETUP_SECRET_TOKEN (64+ characters)
#    - Set secure ADMIN_USERNAME and ADMIN_PASSWORD
#    - Deploy the application
#
# 2. CREATE FIRST ADMIN:
#    - POST to /api/auth/setup-admin with setupToken in request body
#    - Verify admin user was created successfully
#    - Login with the admin credentials to confirm access
#
# 3. DISABLE IMMEDIATELY:
#    - Set ENABLE_SETUP_ADMIN=false
#    - Remove or regenerate SETUP_SECRET_TOKEN
#    - Redeploy the application
#    - Verify setup endpoint returns 404
#
# 4. ONGOING OPERATIONS:
#    - Keep ENABLE_SETUP_ADMIN=false permanently
#    - Create additional admin users through the authenticated admin panel
#    - NEVER re-enable this feature in production
#
# SECURITY BEST PRACTICES:
# ------------------------
# ✓ Only enable during initial deployment to empty database
# ✓ Use setup endpoint immediately, then disable within minutes
# ✓ Generate cryptographically secure tokens (64+ characters)
# ✓ Store SETUP_SECRET_TOKEN in AWS Secrets Manager, not in code
# ✓ Rotate the token after each use (even if it will be disabled)
# ✓ Monitor logs for any setup endpoint access attempts
# ✓ Use strong, unique passwords for ADMIN_PASSWORD
# ✓ Never commit tokens or passwords to version control
# ✓ In CI/CD pipelines, ensure this is false before production deployment
#
# COMPLIANCE NOTES:
# -----------------
# - Leaving this enabled may violate security compliance requirements
# - SOC 2, ISO 27001, and PCI DSS require disabling setup/debug features
# - Regular security audits should verify this is disabled
# - Document the one-time use in security runbooks
#
# Enable/disable setup admin endpoint
# DEVELOPMENT: Can be true for local testing only
# PRODUCTION: MUST ALWAYS be false - audit this regularly!
ENABLE_SETUP_ADMIN=false

# Setup Secret Token - REQUIRED when ENABLE_SETUP_ADMIN=true
# This token is used to authenticate requests to the setup endpoint.
# Generate a cryptographically secure token using one of these commands:
#   openssl rand -hex 64
#   node -e "console.log(require('crypto').randomBytes(64).toString('hex'))"
#
# SECURITY REQUIREMENTS:
# - Minimum 64 characters (128 recommended)
# - Use cryptographically secure random generation
# - Store in AWS Secrets Manager for production
# - Rotate immediately after use
# - Remove or set to empty string when ENABLE_SETUP_ADMIN=false
#
# ⚠️  CRITICAL: Anyone with this token can create admin accounts!
# ⚠️  Treat this with the same sensitivity as database credentials!
SETUP_SECRET_TOKEN=

# Admin User Credentials - Used by setup endpoint
# These credentials are used to create the first admin user when
# calling the /api/auth/setup-admin endpoint.
#
# SECURITY REQUIREMENTS:
# - Use a strong, unique email address for ADMIN_USERNAME
# - ADMIN_PASSWORD must be strong (12+ chars, mixed case, numbers, symbols)
# - Change these immediately after first admin is created
# - Consider these compromised if they appear in logs or error messages
#
# After setup is complete:
# - Login and change the password through the admin panel
# - Create additional admin users through proper authenticated channels
# - Clear these values from .env file
ADMIN_USERNAME=admin@grubtech.com
ADMIN_PASSWORD=change-this-secure-password

# ==============================================
# CORS CONFIGURATION
# ==============================================

# Frontend URL for CORS
FRONTEND_URL=https://grubtech.com

# Additional allowed origins (comma-separated)
# Example: https://staging.grubtech.com,https://preview.grubtech.com
ALLOWED_ORIGINS=

# ==============================================
# DATABASE CONFIGURATION
# ==============================================

# Database type: 'sqlite' for development, 'postgres' for production
DATABASE_TYPE=sqlite

# SQLite database path (for development)
DATABASE_PATH=./grubtech.db

# PostgreSQL connection string (for production/AWS RDS)
# Format: postgresql://user:password@host:port/database
# DATABASE_URL=postgresql://grubtech:password@localhost:5432/grubtech

# Connection pool settings (for PostgreSQL)
DATABASE_POOL_MIN=2
DATABASE_POOL_MAX=10

# ==============================================
# FILE STORAGE CONFIGURATION
# ==============================================

# Storage type: 'local' for development, 's3' for production
STORAGE_TYPE=local

# AWS S3 Configuration (required if STORAGE_TYPE=s3)
AWS_REGION=us-east-1
AWS_ACCESS_KEY_ID=
AWS_SECRET_ACCESS_KEY=
S3_BUCKET_NAME=

# CloudFront CDN URL (optional, for serving images via CDN)
# CLOUDFRONT_URL=https://d123456789.cloudfront.net

# ==============================================
# EMAIL CONFIGURATION (OPTIONAL)
# ==============================================
# Required for lead notifications and auto-replies
# If not configured, leads will still be captured but emails won't be sent

EMAIL_ENABLED=false
EMAIL_HOST=smtp.gmail.com
EMAIL_PORT=587
EMAIL_USER=your-email@example.com
EMAIL_PASS=your-app-password
EMAIL_FROM=noreply@grubtech.com
ADMIN_EMAIL=admin@grubtech.com

# ==============================================
# LOGGING CONFIGURATION
# ==============================================

# Log level: error, warn, info, http, debug
LOG_LEVEL=info

# Log format: 'json' for production (CloudWatch), 'pretty' for development
LOG_FORMAT=pretty

# ==============================================
# RATE LIMITING
# ==============================================

# Rate limit window in milliseconds (default: 15 minutes)
RATE_LIMIT_WINDOW_MS=900000

# Maximum requests per window
RATE_LIMIT_MAX_REQUESTS=1000

# ==============================================
# FEATURE FLAGS
# ==============================================

# Enable analytics endpoints
ENABLE_ANALYTICS=true

# ==============================================
# AWS DEPLOYMENT NOTES
# ==============================================
#
# For AWS ECS/Fargate deployment:
# 1. Store secrets in AWS Secrets Manager
# 2. Use IAM roles instead of explicit AWS credentials
# 3. Set DATABASE_TYPE=postgres and configure RDS
# 4. Set STORAGE_TYPE=s3 and configure S3 bucket
# 5. Set LOG_FORMAT=json for CloudWatch Logs
# 6. Set NODE_ENV=production
# 7. Ensure ENABLE_SETUP_ADMIN=false
#
# Environment variables can be injected via:
# - ECS Task Definition
# - AWS Secrets Manager
# - Parameter Store
#
# Health check endpoints:
# - /api/health - Comprehensive health check
# - /api/ready - Readiness check for container orchestration
#
# ==============================================
